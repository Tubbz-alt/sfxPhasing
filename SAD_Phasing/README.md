# Get Start
The prepared data for SAD in Stanford Box is in a2a_S_SAD and strep_v2 folder. Each of them contains a reflection data (.mtz) and a sequence file (.seq). 

For a2a_S_SAD:

Type: python batch_sub.py -rfl a2a.mtz -seq a2a.fasta -SFAC S -q psanaq -n 12 

Note: since the sequence file for this case contains methionine (M) and cystine (C). The DSUL parameter and heavy atom number for SHELX search will be read directly from sequence file and forming grids. -SFAC is the atom type. It is case insensitive.

For strep_v2:

Type: python batch_sub.py -rfl cxic0415_sz_ccp4IF.mtz -seq strep_mono.fasta.txt -SFAC Se -q psanaq -n 12 -na 4. 

Note: Here tying the -na parameter is crucial. Because the script cannot get M and C from the sequence file in this case. If you do you input -na, there will be an error saying that M cannot be found so please input the atoms number. If you are not sure, just enter some number reasonable. If you input N, it will scan through N-2 to N+2.

# batch.py and parameter.json

This file is used to do batch submission. It connects directly with Se_SAD_automation file. The 'Grid' is formed by this file.
A typical Grid (or say 'tree') of Sulfur SAD will be: /DSUL#/threshold#/resolution#/atom_number#. A typical Grid of Se SAD will be /threshold#/resolution#/atom_number#. 

DSUL will be the disulfide atom within the heavy atom sites. The number is automated by reading the sequence file and count the number of Cystine (C). Highest possible number of disufide atoms are number of C over 2. The totol number of disulfide will be scanned from 1 to the highest possible number. 

Threshold is the cutoff of the occupancy shown in the heavy atom pdb file generated by the SHELXD. Sometimes it is hard to distinguish will is the threshold of the occupancy so that we can drop all the atoms below this threshold. Therefore, we scan a range of threshold to make sure that we are not omitting anything. It is defined to be (0.2 to 0.5)

Resolution is set by inspecting the input reflection file. The highest resoltuion (res) is read and we scan from res to res+1.4 with the interval of 0.1

Atom_number is defined in separated cases. If Selenium (Se) is the anomalous scatterer, highest Se number will be number of methionine (M) in the sequence file. If Sulfur (S) is the anomalous scatterer, highest S number will be number of methionine (M) plus the number of cystine (C). The scan range of both case will be from half of the highest number to the highest number.

ESEL is defined to be 1.3 for S-SAD and 1.5 for Se-SAD.

Beside these scanned parameters, there are several other defined paramters: minimal distance between atoms (MIND1), minimal distance between symmetry units (MIND2), and highest resolution cutoff. They are determined only on the type of the scatterer. The detailed numbers are in the json file. This json file will be read directly by batch.py.
 
NOTICE: All of the parameters (scanned or fixed) are for SHELXC/D. Crank2 do not take parameters.

# SAD_Automation.py

This file will be directly called by batch.py. It controls the flow of two phasing algorithm scripts below: SHELX_script.py and Crank2.py. 

Firstly, It passed reflection file and all of the mentioned paramters to SHELX_script.py. Whether SHELXD produced heavy atom site pdb or not is judged within SHELX_script.py. It appropriate files have not been generated, SHELX_script will force the whole progrma to terminate.

If the SHELX produced the appropriate files (does not necessarily containing the correct information), SAD_automation.py will arouse the Crank2.py. No matter what Crank2.py will one of three possibilities:
1) 'Majority of model was successfully built!'. This means the reconstruction is on the right track. Further refinement using Autobuild will be meaningful to do.
2) 'Wrong substructure or very weak phases suspected: the model building seems unsuccessful'. It means crank2 has tried but cannot reach to a converged R/Rfree value. 
3) Any possible file parsing or parameter extraction error. Developers will inspect it continuously.

If 1) is the case, the result will be put at the directory in which batch_submission.py locates. And finally there will be a file called "final_result.txt" containing all the successful case and their corresponding R/Rfree value.
